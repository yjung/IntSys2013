<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel name="stylesheet" href="main.css">
<script src ="initalize.js"></script>
<script>
// make sure browser knows requestAnimationFrame method
if (!window.requestAnimationFrame) {
    window.requestAnimationFrame = (function () {
        return  window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (callback, element) {
                    window.setTimeout(callback, 16);
                };
    })();
}

// our main rendering class
// http://www.khronos.org/registry/webgl/specs/latest/1.0/


// Application object, used to minimize global variables
var MyApp = {
    renderer: null,

    setDuration: function (event) {
        if (this.renderer && (!event || event.keyCode == 13)) {
            var numSeconds = +document.getElementById("sec").value;
            this.renderer.setDuration(numSeconds);
        }
    },

    toggleAnim: function (btn) {
        if (this.renderer) {
            var anim = this.renderer.toggleAnim();
            btn.innerHTML = anim ? "Stop Animation" : "Start Animation";
        }
    },

    // cleanup
    shutdown: function () {
        if (this.renderer) {
            this.renderer.cleanup();
            this.renderer = null;
        }
    },

    // main entry point
    initialize: function () {
        var that = this;
        var canvas = document.getElementById("glCanvas");

        this.renderer = new Renderer(canvas);

        if (this.renderer.initialize()) {
            var statsDiv = document.getElementById("time");

            (function mainLoop() {
                that.renderer.tick(statsDiv);
                window.requestAnimationFrame(mainLoop);
            })();
        }
        else {
            console.error("Could not initialize WebGL!");
            this.renderer = null;
        }
    }
};
</script>
</head>

<body onload="MyApp.initialize();" onunload="MyApp.shutdown();">

<canvas id="glCanvas" width="512" height="512"></canvas>

<div class="container">
    <div id="time"></div>
    <div id="btns">
        <button onclick="MyApp.setDuration(null);">Set Duration</button>
        to
        <input id="sec" value="2" size="6" onkeyup="MyApp.setDuration(event);">
        <label for="sec">sec</label><br>
        <button onclick="MyApp.toggleAnim(this);">Start Animation</button>
    </div>
</div>

</body>
</html>